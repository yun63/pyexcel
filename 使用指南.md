Excel导表工具使用指南
=====================

## 1 安装环境

### 1 Mac & Linux:

1. python2.7
    
    安装pip工具

    安装第三方xlrd库
    `pip install xlrd` 或者`pip install -r requirements.txt`


### 2 Windows:

1. 安装python2.7

    https://www.python.org/ftp/python/2.7.17/python-2.7.17.amd64.msi

2. 安装xlrd库
    

## 2 配置Excel

在config.json文件中可以指定excel文件的目录

```
{
    "excel_path": "../excel",
    "output_path": "../json",
 }
```
excel_path指定excel文件存放路径
output_path指定生成json文件的存放路径


```
案例一: 生成字典型json

Excel:
               ----------------------------------------------------------------------------------------
     第1行 -> | 这里可以写一些注释，给产品看的，代码里直接跳过                                         |
               ----------------------------------------------------------------------------------------
 第2行表头 -> |  *id#int  | name#string  |   attr#list   |   data#map    | !sex#enum#{1,2}|  open#bool |
               ----------------------------------------------------------------------------------------    =>>
 第3行数据 -> |   10001   |   诸葛亮     |   [1,2,3,4]   | {"a":1,"b":2} |       1        |     No     |
               ----------------------------------------------------------------------------------------
              |   10002   |   貂蝉       |   [1,2,3,4]   | {"a":5,"b":8} |       2        |     Yes    |
               ----------------------------------------------------------------------------------------
 |hero#map|

~~~~~~~~~~~~
hero/0.json:

 {
    "1001": {
        "id": 10001,
        "name": "诸葛亮"，
        "attr": [1,2,3,4],
        "data": {'a': 1, 'b': 2},
        "sex": 1,
        "open": false
    },
    "1002": {
        "id": 1002,
        "name": "貂蝉",
        "attr": [1,2,3,4],
        "data": {'a': 5, 'b': 8},
        "sex": 2,
        "open": true
    }
 }
```

```
案例二: 生成列表型json

Excel:
               ----------------------------------------------------------------------------------------
     第1行 -> | 这里可以写一些注释，给产品看的，代码里直接跳过                                         |
               ----------------------------------------------------------------------------------------
 第2行表头 -> |  *id#int  | name#string  |   attr#list   |   data#map    |  sex#enum#{1,2}|  open#bool |
               ----------------------------------------------------------------------------------------    =>>
 第3行数据 -> |   10001   |   诸葛亮     |   [1,2,3,4]   | {"a":1,"b":2} |       1        |     No     |
               ----------------------------------------------------------------------------------------
              |   10002   |   貂蝉       |   [1,2,3,4]   | {"a":5,"b":8} |       2        |     Yes    |
               ----------------------------------------------------------------------------------------
 |hero#list|

~~~~~~~~~~~~
hero/0.json:

 [
    {
        "id": 10001,
        "name": "诸葛亮"，
        "attr": [1,2,3,4],
        "data": {'a': 1, 'b': 2},
        "sex": 1,
        "open": false
    },
    {
        "id": 1002,
        "name": "貂蝉",
        "attr": [1,2,3,4],
        "data": {'a': 5, 'b': 8},
        "sex": 2,
        "open": true
    }
 ]
```

### 2.1 表头

特殊符号：

\* 主键标识符号，表明该列是一个主键，例如*id，表明id作为主键
    主键可以有多个，当有多个主键是，主键变为以'_'连接的字符串

\# key名和单元格类型分隔符，例如：name#string 表明 name这列的类型是字符串

! 忽略标识符
当生成数据时，不想包含某列的数据，可以对指定的列名前添加!符号，这样在生成json后，json不包含该列数据，例如对于案例二hero表，如果不想包含open列，可以设置!open, 这样生成的json变为

```
Excel:
               ----------------------------------------------------------------------------------------
     第1行 -> | 这里可以写一些注释，给产品看的，代码里直接跳过                                         |
               ----------------------------------------------------------------------------------------
 第2行表头 -> |  *id#int  | name#string  |   attr#list   |   data#map    |  sex#enum#{1,2}| !open#bool |
               ----------------------------------------------------------------------------------------    =>>
 第3行数据 -> |   10001   |   诸葛亮     |   [1,2,3,4]   | {"a":1,"b":2} |       1        |     No     |
               ----------------------------------------------------------------------------------------
              |   10002   |   貂蝉       |   [1,2,3,4]   | {"a":5,"b":8} |       2        |     Yes    |
               ----------------------------------------------------------------------------------------
 |hero#list|

 [
    {
        "id": 10001,
        "name": "诸葛亮"，
        "attr": [1,2,3,4],
        "data": {'a': 1, 'b': 2},
        "sex": 1
    },
    {
        "id": 1002,
        "name": "貂蝉",
        "attr": [1,2,3,4],
        "data": {'a': 5, 'b': 8},
        "sex": 2
    }
 ]

```

### 2.2 数据类型

1. int 整数
例如 1, 200,3000

2. float 浮点数
例如 1.2, 100.01, 200,30

3. string 字符串
例如 诸葛亮, hello,world
由于excel单元格中配置的数据都可以当成字符串，指定单元格的类型为字符串，则可以直接填写内容，list和map中的数据除外.

4. bool 布尔值
工具对该类型有要求，只能填写Yes/No, Y/N, YES/NO

5. enum 枚举类型
enum@{1,2,3} 表示该列的单元格数据只能配置成1、2、3之一，其他数据都不正确，工具不会生成json.

6. list 列表
例如 [1, 2, 3]、["游戏", "张飞", "xxx"], 注意逗号是英文逗号，切记不要使用中文逗号.

7. map 字典
例如 {"attack": 300, "defence": 200, "rate": 0.2}

>  list和map都支持嵌套配置，但要主要不要嵌套层次太深，配置起来容易出错，也难以配置
> 
> list嵌套: [{"a": 100, "b": 200}, {"a": 300, "b": 400}]
>
> map嵌套: {"a": [1, 2, 3], "b": [1, 2, 3, 4], "c": ["hello", "world"]}

## 3 使用

目前工具只支持命令行，
在本文档路径下，在终端执行:

`python pyexcel.py --excel tpl.xlsx`

如果成功，在config.json output_path指定的路径下会生成对应的sheet/0.json文件，其中sheet为excel表单sheet名称

如果sheet名称为hero，在output_path指定的路径下回生成hero目录，在hero目录下有0.json数据文件.

## 4 注意事项

1. 在刚开始使用时，可以由技术人员设置好excel sheet表头和格式，并提供1行样例数据以供产品同学参考，之后由产品人员根据样例来配置数据
2. 单元格数据尽量避免复杂的数据，尤其是list和map深层次的嵌套，节省因配错而检查数据格式的时间
3. 表设计要清晰合理，如果因功能比较复杂而导致表设计复杂，可以考虑拆分成多张表来实现，在代码里重新组织

